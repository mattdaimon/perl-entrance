matt.daimon 17:51
皆様、こんばんわ。Mojoliciousの予習をしています。
どうしても納得がいかないので教えて頂きたく思います。
get '/' => sub { 省略 };
上記は2個の引数を渡しているとのことです。
スラッシュが引数であることはわかります。
subの方はリファレンスということであれば、XXXXX => sub にならないのでしょうか？
省略記法であれば省略されている記述を教えて頂きたく思います。
そうでなければ、もう少し解説して頂けないでしょうか？
なんだか気持ち悪いです。よろしくお願い致します。 （編集済み） 
mahoyaya 20:26
何が聞きたいのかちゃんと理解していませんが、上の表記はイメージ的に以下と同じで、 => (ファットカンマ)は , と同じ意味です。

sub get {
  #snip
}
get("/", sub { return 1; });

HASHで使うファットカンマも同じです。

my $h = {
  foo => 'bar',
};

と

my $h = {
  foo, 'bar',
};

は同じです。
答えになってますか？
sago35 21:20
mahoyaya さんが書いてるのと同じですが、 get '/' => sub {...} と get '/', sub {...} と get('/' => sub {...}) と get('/', sub {...})とは見た目が違うだけで、同じ意味です。関数に一つのハッシュリファレンスを渡すときは get {'/' => sub {...}} もしくは get {'/' , sub {...}} もしくは get({'/' => sub {...}}) もしくは get({'/', sub {...}}) (この 4 つも同じ意味) と書く必要があります。
matt.daimon 16:47
mahoyayaさん、sago35さん、ありがとうございます。get '/' => sub { ... }; は1個のハッシュリファレンスを渡している。
get '/', sub { ... }; ファットカンマで2個の引数を渡している。
但し、両方共書き方が違うだけで意味は同じ。で理解はあっているでしょうか？get '/' => sub { ... }; と書いていて2個の引数とテキストでは説明されていたので混乱したようです。
こういうちょっとしたことでつまずいてしまいます。
説明して頂くとハッ!!とするのですが。
ありがとうございます!!!!
anatofuz 16:54
=> と , は意味が同じなのでこの場合は2この引数で共通です!
(ハッシュリファレンスは => が重要でなく, {} の中にあるのが重要という感じです)
matt.daimon 17:12
anatofuz さん、ありがとうございます。
なるほど、 => であっても2個の引数でファットカンマの時と同じ考えとのことですね!!!!
{}の中にあるのが重要というのはちょっと理解できずです。修業します(^^; （編集済み） 
matt.daimon 17:36
無名ハッシュをいきなりgetに渡しているんですよね...
anatofuz 17:51
多分そこが誤解と思っていて、これは「ハッシュリファレンス」でなくて、「ただのリスト」を渡しています。
(プログラマ的に / と 実行されるactionがハッシュみたいに対応していると書けるとわかりやすいので、Perlの => と , が同じ意味なのを利用しています) （編集済み） 
anatofuz 17:57
get .... は関数呼び出しなので、リストしか渡せないので、ハッシュにはならず、配列が渡さます。
get '/' => sub { ... }; だと、 「 / という文字列」と 「サブルーチンリファレンス」の2つをリストで送っている事になります。 (get ('/', $subref)) と意味が同じです
{} で意味が変わるのは

#!/usr/bin/env perl
use strict;
use warnings;
use Data::Dumper;

my $array_test = ['helo' => 1, 'foo' => 2];
my $hash_test  = {'helo' , 1, 'foo' , 2};

print Dumper $array_test;
print Dumper $hash_test;

試しにこういうプログラムを書くと => を使っている $array_test は [] の中で定義しているので、「**配列リファレンス**」になり、 $hash_test は {} の中にあるのでハッシュリファレンスになります
matt.daimon 18:58
anatofuz さん、今必死に読みといていますので少々お時間下さい。
matt.daimon 22:08
anatofuz さん、get関数予備出し時は、配列リファレンスやハッシュリファレンスの書き方を真似てるだけで、 /  と言う文字列とサブルーチンリファレンス sub{ ... }   の2個を引数として渡しているのですね。 （編集済み） 
配列リファレンスとハッシュリファレンスと違いもありがとうございます。これについては復習ですね。 （編集済み） 
matt.daimon 22:15
getの呼出しで => が出て来て混乱しました。
たぶん、やっと理解できたかな？
anatofuzさん、ありがとうございます!!!!:ハハハ:
tomcha 00:00
sub {} の無名サブルーチンリファレンスは入学式ではやってない定義ですね
Perlゼミの記事にあります。
https://tutorial.perlzemi.com/blog/20080704121518.html
tutorial.perlzemi.comtutorial.perlzemi.com
サブルーチンのリファレンス - Perl入門ゼミ
サブルーチンのリファレンスとは、サブルーチンを指し示すもののことです。
tomcha 00:13
Mojolicious内の独特の記法は、“そう書くものだ“と理解する方がよいかと思います。
, と => が等価なのは下のコードで分かるかと思います。
https://gist.github.com/tomcha/00a5e66bdd68663b6fe564454f456b5bなせ、Mojoで => が使われているかは、多分そう書くとイメージしやすいから採用されているのかな？と個人的には思います。
（get で ‘/’ を呼び出す　=>　sub{}が実行される　と直感で読める）
matt.daimon 07:44
tomcha さん、おはようございます。触りだけ読みました(後ろの方は難しいのが出てきてるので...)。
「サブルーチン」の「リファレンス」は、
「配列」の「リファレンス」や
「ハッシュ」の「リファレンス」みたいなのですね!!!!gistのコードも実行しました。
, と => は全く一緒の意味なんですね。表記の問題だけで。Mojoで => が使われている理由は、そうだすれば確かに分かり易いです。
tomcha さん、ありがとうございます!!!!p.s.
皆様の色々な角度から説明を頂けてありがたい限り (´；ω；｀)ﾌﾞﾜｯ
これでわからないはずがない...
sironekotoro 11:07
あえて分解して書くとこんな感じかー。より引数にリストを渡してるっぽさが溢れる。
https://gist.github.com/sironekotoro/2306f67323d9e75b2a8ddc1feca31e88
macopy 13:18
多分混乱するから説明されてないとは思いますが、ファットカンマの左辺値が一定の法則に従っていると文字列扱いになります。カンマとファットカンマの違いはそこです
https://perldoc.jp/docs/perl/5.26.1/perlop.pod#Comma32Operator
perldoc.jpperldoc.jp
perlop - Perl の演算子と優先順位 - perldoc.jp
Perl の演算子と優先順位
matt.daimon 21:00
sironekotoro さん、こんばんわ。
トドメのもう一発来ました。get( '/', $subroutine_reference );この部分が正に『getにリストで "/" と "サブルーチンリファレンス " を渡している』ですね。
分解して頂くと、テキストの内容と同じ流れでより分かり易いです。sironekotoro さん、ありがとうございます!!!!
嬉しくて泣いていいですか?(いやほんと)
sago35 22:43
今回の件に関するサンプルコードを作ってみました。全パターン？愚直に試す感じにしてみましたが、伝わるだろうか。
https://wandbox.org/permlink/CwN9bZ5rYsQzRFdX
wandbox.org
[Perl] perl 5.30.0 - Wandbox
use strict; use warnings; sub get { printf "arg1 : %s\n", $[0]; printf "arg2 : %s\n", $[1] // "(nothing)"; } printf "第一引数に '/' を設定、第二引数に無名サブルーチン
matt.daimon 23:24
macopy さん、こんばんわ。
はい、見事に混乱しております(笑)。
my %hash = ('hoge', 'fuga');
と
my %hash = (hoge => 'fuga');
は同じという意味でしょうか。
macopy さん、とりもあえず有難う御座います!!!!
悶えております。 （編集済み） 
macopy 00:12
そのとおり同じです！
matt.daimon 21:05
sago35 さん、こんばんわ。
遅くなって申し訳ありません。
頂いたコードをVScodeにコピペして実行して睨めっこしています。
ちょっとお時間頂きたく。
というか、この洗礼を若い時に受けたかったよ...
ここに飛び込んでくる若者が羨ましい。
ちなみにsago35 さんの教え方はいきなり悟りの部分をぶつけてくる感じですよね。
全然わからなくなって、はまってる時はこれが効きます。
matt.daimon 08:19
sago35 さん、おはようございます。
'/' と無名サブルーチンリファレンスをを渡す方の感じは多分掴めたと思います。
リストを渡すときは () は無くてもよいのですね。

printf "第一引数にハッシュリファレンスを設定してコール\n";
get({'/',   sub { printf "ok\n" }});

こちらの一番外側の () は構文としての意味はなさそうですが、理解はあっているでしょうか？
一番外側の {} が付いた時点でハッシュリファレンスになってしまっているということなのかと。 （編集済み） 
sago35 19:30
@matt.daimon
() について、構文としての意味は、ない事はないのですが、説明がややこしいです。
なので、定義したサブルーチンの呼び出しはなるべく () をつけた方が色々なことを考えなくてよいと思います。で、今書いた↑の理解で自分としては十分だと思いますが、「なんで？」っていう部分が気になる場合は、このあたりに色々と書かれています。読まなくても良いので、↓のコードを実行してみて「ふーん」って思っておくと良いかもしれません。
https://perldoc.jp/docs/perl/5.26.1/perlfunc.pod
https://metacpan.org/pod/perlfuncで、そのあたりからのサンプルコードです。 Ctrl + Enter を押すか、 Run ボタンを押すとその場で実行できます。
https://wandbox.org/permlink/FfxVutOCrQ0294Ko
perldoc.jpperldoc.jp
perlfunc - Perl 組み込み関数 - perldoc.jp
Perl 組み込み関数
metacpan.orgmetacpan.org
perlfunc
Perl builtin functions
wandbox.org
[Perl] perl 5.30.0 - Wandbox
use strict; use warnings; local $\ = "\n"; print 1+2+4; # Prints 7. print(1+2) + 4; # Prints 3. print (1+2)+4; # Also prints 3! print +(1+2)+4; # Prints 7. print ((1+2)+4); # Prints 7.
sago35 19:37
myprint() の実装直しました。こちらの方がより良いかな、と。
https://wandbox.org/permlink/uVyQAn1hE3VxXmhS
wandbox.org
[Perl] perl 5.30.0 - Wandbox
use strict; use warnings; local $\ = "\n"; print 1+2+4; # Prints 7. print(1+2) + 4; # Prints 3. print (1+2)+4; # Also prints 3! print +(1+2)+4; # Prints 7. print ((1+2)+4); # Prints 7.
matt.daimon 08:12
@sago35 さん、おはようございます。
実行してみました。
確かに妙にややこしい結果ですね。
サブルーチンで呼び出しても同じで妙にややこしい結果。
不測の結果を避ける為にはなるべく () を付ける、ですね。
どうして?の部分は読んでいませんが、今はこれで納得できます。
ありがとうございます!!!!
